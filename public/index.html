<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Warehouse 231 Studios</title>
    <link rel="stylesheet" href="styles.css">

</head>

<body>
    <nav>
        <a href="#" class="active">Home</a>
        <a href="#">Studios</a>
        <a href="#">Interactive</a>
        <a href="#">Contact</a>
    </nav>
    <header>
        <div class="logo">Warehouse 231</div>
        <div class="tagline">Real Rooms. Real Vibe. Analog Sound.</div>
    </header>
    <div class="hero">
        <h2>ğŸ›ï¸ Welcome to the Future of Recording</h2>
        <div class="logo-container">
            <img src="images/w231Logo.jpg" alt="Warehouse 231 Logo" class="w231-logo dystopian" />
        </div>
        <div id="studio-slideshow" class="slideshow">
            <img src="studio-images/studio1.jpg" class="slide active" alt="Studio Photo">
        </div>
        <p>
            Step out of the algorithm and into the analog. <br>
            Warehouse 231 is your antidote to bedroom AI soundâ€”where real rooms, vintage gear, and studio magic collide
            under neon and shadow.<br>
            <br>
            <span style="color:var(--accent)">Come get the <b>studio experience</b> you can feel.</span>
        </p>
    </div>
    <div id="audio-controls" class="floating-audio-controls">
        <span id="now-playing" class="now-playing">
            <span id="now-title"></span><br>
            <span id="now-artist"></span>
        </span>
        <button id="mute-btn" class="mute-btn" aria-label="Mute">
            ğŸ”Š
        </button>
    </div>
    <audio id="bg-audio" preload="auto"></audio>
    <!-- Add more content/sections here as you develop! -->
    <script>

        // ===== HOOME PAGE SLIDE SHOW
        let studioImages = [];
        let current = 0;
        const slideshow = document.getElementById('studio-slideshow');
        const img = slideshow.querySelector('.slide');

        function showNextSlide() {
            if (studioImages.length === 0) return;

            // Clone the current img to animate it out
            const oldImg = img.cloneNode();
            oldImg.src = img.src;
            oldImg.classList.remove('active');
            oldImg.classList.add('glitch-out');
            slideshow.appendChild(oldImg);

            // Switch image after glitch out
            setTimeout(() => {
                current = (current + 1) % studioImages.length;
                img.src = 'studio-images/' + studioImages[current];
                img.classList.add('active');
            }, 350); // Halfway through glitch-out

            // Remove glitch-out image after animation
            setTimeout(() => {
                if (oldImg && oldImg.parentNode) oldImg.parentNode.removeChild(oldImg);
                img.classList.remove('active'); // Let glitch-in happen after glitch-out is done
                void img.offsetWidth; // force reflow to restart animation
                img.classList.add('active');
            }, 600); // End of glitch-out
        }

        // Fetch image filenames from server
        fetch('/api/studio-images')
            .then(res => res.json())
            .then(files => {
                studioImages = files;
                if (studioImages.length > 0) {
                    img.src = 'studio-images/' + studioImages[0];
                    img.style.display = '';
                    img.classList.add('active');
                    setInterval(showNextSlide, 2500);
                } else {
                    slideshow.innerHTML = '<p style="text-align:center;color:#bbb;">No images found.</p>';
                }
            })
            .catch(() => {
                slideshow.innerHTML = '<p style="text-align:center;color:#f44;">Error loading images.</p>';
            });




        // ===== END HOME SLIDE SHOW

        // ==== AUDIO

        let wavTracks = [];
        let audio = document.getElementById('bg-audio');
        let currentTrack = 0;

        const nowPlaying = document.getElementById('now-playing');
        const muteBtn = document.getElementById('mute-btn');

        // Load track metadata from JSON
        fetch('audio/tracks.json')
            .then(res => res.json())
            .then(tracks => {
                wavTracks = tracks;
                if (wavTracks.length > 0) {
                    playTrack(0);
                }
            });

        function playTrack(index) {
            if (!wavTracks.length) return;
            currentTrack = index % wavTracks.length;
            audio.src = 'audio/' + wavTracks[currentTrack].file;

            // Update Now Playing display (two lines)
            document.getElementById('now-title').textContent = wavTracks[currentTrack].title;
            document.getElementById('now-artist').textContent = wavTracks[currentTrack].artist || "";

            audio.play();
        }


        audio.addEventListener('ended', function () {
            playTrack((currentTrack + 1) % wavTracks.length);
        });

        muteBtn.addEventListener('click', () => {
            audio.muted = !audio.muted;
            muteBtn.classList.toggle('muted', audio.muted);
            muteBtn.textContent = audio.muted ? 'ğŸ”‡' : 'ğŸ”Š';
        });

        audio.style.display = "none";

        // For browsers that block auto-play
        window.addEventListener('click', function autoPlayOnce() {
            audio.play();
            window.removeEventListener('click', autoPlayOnce);
        });

        // ==== END AUDIO

    </script>

</body>

</html>